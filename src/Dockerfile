# syntax=docker/dockerfile:1.2    
FROM python:3.10-alpine

ARG SYSTEM_USER_NAME
ARG FAKTURAPP_ROOT
ARG WORK_DIR
ARG API_URL
ARG API_TOKEN
ARG DATA_DANYCH
ARG FILE_MASK

RUN addgroup -S ${SYSTEM_USER_NAME} && adduser -S ${SYSTEM_USER_NAME} -G ${SYSTEM_USER_NAME}
# USER root
WORKDIR ${WORK_DIR}
USER ${SYSTEM_USER_NAME}

ENV FAKTURAPP_ROOT=${FAKTURAPP_ROOT}
ENV API_URL=${API_URL}
ENV API_TOKEN=${API_TOKEN}
ENV DATA_DANYCH=${DATA_DANYCH}
ENV FILE_MASK=${FILE_MASK}

COPY --chown=${SYSTEM_USER_NAME}:${SYSTEM_USER_NAME} . $FAKTURAPP_ROOT
RUN mkdir "${FAKTURAPP_ROOT}/output_dir" && chown -R ${SYSTEM_USER_NAME}:${SYSTEM_USER_NAME} "${FAKTURAPP_ROOT}/output_dir" 
RUN ls -l $FAKTURAPP_ROOT

RUN python3 -m pip install -r "${FAKTURAPP_ROOT}/requirements.txt"

CMD ["sh", "-c", "python3 ${FAKTURAPP_ROOT}/run_fakturapp.py"]